# Nginx 配置示例 - 子目录部署
# 用于部署在 /temp/download/transform/out/ 路径下

location /temp/download/transform/out {
    alias /var/www/html/temp/download/transform/out;
    index index.html;
    
    # 关键配置：处理 Next.js 静态导出的路由
    # 1. 尝试直接访问的文件（如 /js-object-to-json）
    # 2. 尝试作为目录访问（如 /js-object-to-json/）
    # 3. 尝试添加 .html 后缀（如 /js-object-to-json.html）
    # 4. 最后回退到 index.html
    try_files $uri $uri/ $uri.html /temp/download/transform/out/index.html;
    
    # 禁止访问隐藏文件
    location ~ /\. {
        deny all;
    }
    
    # 静态资源缓存（Next.js 资源）
    location ~* ^/temp/download/transform/out/_next/static {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }
    
    # 其他静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webmanifest)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }
    
    # HTML 文件不缓存
    location ~* \.html$ {
        expires -1;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
    }
}

